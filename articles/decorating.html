<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Decorating Sankey diagrams • ggsankeyfier</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Decorating Sankey diagrams">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggsankeyfier</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.8.0003</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/data_management.html">Sankey data management</a></li>
    <li><a class="dropdown-item" href="../articles/decorating.html">Decorating Sankey diagrams</a></li>
    <li><a class="dropdown-item" href="../articles/loopdeloop.html">Loop De Loop</a></li>
    <li><a class="dropdown-item" href="../articles/positioning.html">Positioning Sankey elements</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pepijn-devries/ggsankeyfier/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Decorating Sankey diagrams</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pepijn-devries/ggsankeyfier/blob/master/vignettes/decorating.Rmd" class="external-link"><code>vignettes/decorating.Rmd</code></a></small>
      <div class="d-none name"><code>decorating.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="decorating-nodes-and-edges-with-aesthetics">Decorating nodes and edges with aesthetics<a class="anchor" aria-label="anchor" href="#decorating-nodes-and-edges-with-aesthetics"></a>
</h2>
<p>With the <code>waist</code> aesthetic you can modify the shape of the
edge curve, this is presented in more detail in the <a href="#curve-shape">Curve shape</a> section. Here it is shown how Nodes
and edges can be decorated with the <code>colour</code> (border of nodes
and edges), <code>fill</code> (inside of nodes and edges), and
<code>alpha</code> aesthetics.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pepijn-devries.github.io/ggsankeyfier/">ggsankeyfier</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ecosystem_services"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Let's subset the example data to create a less cluttered</span></span>
<span><span class="co">## Sankey diagram</span></span>
<span><span class="va">es_sub</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">ecosystem_services</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">RCSES</span> <span class="op">&gt;</span> <span class="fl">0.005</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/pivot_stages_longer.html">pivot_stages_longer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"activity_realm"</span>, <span class="st">"biotic_realm"</span>, <span class="st">"service_section"</span><span class="op">)</span>,</span>
<span>                      <span class="st">"RCSES"</span>, <span class="st">"service_section"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data    <span class="op">=</span> <span class="va">es_sub</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">stage</span>, y <span class="op">=</span> <span class="va">RCSES</span>, group <span class="op">=</span> <span class="va">node</span>,</span>
<span>    edge_id <span class="op">=</span> <span class="va">edge_id</span>, connector <span class="op">=</span> <span class="va">connector</span>, colour <span class="op">=</span> <span class="va">stage</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## apply fill and alpha aesthetic only to edges (not the nodes)</span></span>
<span>  <span class="fu"><a href="../reference/geom_sankeyedge.html">geom_sankeyedge</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="va">RCSES</span>, fill <span class="op">=</span> <span class="va">service_section</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_sankeynode.html">geom_sankeynode</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill   <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>         alpha  <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>         colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></span></code></pre></div>
<p><img src="decorating_files/figure-html/aesthetics-1.png" width="624"></p>
<p>Note that both nodes and edges can be decorated separately. Also note
that each variable that is assigned to one or more aesthetics will get
its own guide legend. More about this in the section <a href="#keys-and-legends">Keys and legends</a>.</p>
</div>
<div class="section level2">
<h2 id="additional-layers">Additional layers<a class="anchor" aria-label="anchor" href="#additional-layers"></a>
</h2>
<p>When you want to add additional layers to your plot (such as text
labels), it is important that those layers apply the same statistics and
positioning as the <code>geom_sankeyedge</code> or
<code>geom_node</code> layers. To illustrate we first need a base plot
onto which the layers can be added:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/position_sankey.html">position_sankey</a></span><span class="op">(</span>v_space <span class="op">=</span> <span class="st">"auto"</span>, order <span class="op">=</span> <span class="st">"ascending"</span>, align <span class="op">=</span> <span class="st">"justify"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  data    <span class="op">=</span> <span class="va">es_sub</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">stage</span>, y <span class="op">=</span> <span class="va">RCSES</span>, group <span class="op">=</span> <span class="va">node</span>,</span>
<span>    edge_id <span class="op">=</span> <span class="va">edge_id</span>, connector <span class="op">=</span> <span class="va">connector</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>When you want to add additional layers and you want to let them line
up with the nodes and edges, all you need to do is: use a consistent
call to <code><a href="../reference/position_sankey.html">position_sankey()</a></code> for all layers; and add the
<code><a href="../reference/stat_sankey.html">stat_sankeyedge()</a></code> when you want to line up your layer with
the edges in the sankey diagram. This is shown in the example below
where a <code><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">ggplot2::geom_segment()</a></code> layer is added to the
plot.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_sankeynode.html">geom_sankeynode</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">pos</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">service_section</span><span class="op">)</span>,</span>
<span>               position <span class="op">=</span> <span class="va">pos</span>, stat <span class="op">=</span> <span class="st">"sankeyedge"</span>,</span>
<span>               arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="decorating_files/figure-html/layer_segment-1.png" width="576"></p>
<p>When you want to align your layer with the nodes in a diagram, you
need to add <code><a href="../reference/stat_sankey.html">stat_sankeynode()</a></code> to your layer. Below a
<code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">ggplot2::geom_bar()</a></code> layer is added to the plot, which
appears as a normal <code><a href="../reference/geom_sankeynode.html">geom_sankeynode()</a></code> layer. This is
because they are very similar but mostly just differ in the positioning
and stats that are applied.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_sankeyedge.html">geom_sankeyedge</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">service_section</span><span class="op">)</span>, position <span class="op">=</span> <span class="va">pos</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">pos</span>, stat <span class="op">=</span> <span class="st">"sankeynode"</span><span class="op">)</span></span></code></pre></div>
<p><img src="decorating_files/figure-html/layer_bar-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="curve-shape">Curve shape<a class="anchor" aria-label="anchor" href="#curve-shape"></a>
</h2>
<p>The curves that connect the nodes in <code>ggsankeyfier</code> are
drawn as symmetrical widened <a href="https://en.wikipedia.org/wiki/B%C3%A9zier_curve" class="external-link">Bézier</a>
curves. The slope of the curve can be controlled with the
<code>slope</code> parameter. The curve becomes very steep when
<code>slope = 1</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_sankeyedge.html">geom_sankeyedge</a></span><span class="op">(</span>slope <span class="op">=</span> <span class="fl">1</span>, position <span class="op">=</span> <span class="va">pos</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">service_section</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_sankeynode.html">geom_sankeynode</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">pos</span><span class="op">)</span></span></code></pre></div>
<p><img src="decorating_files/figure-html/curve_shape-1.png" width="576"></p>
<p>You could even go beyond the <code>slope</code> of 1, but then the
curve will start to zigzag. With values less than 1 will result in
gentler slopes.</p>
<p>We can also play with how much the curve is widened. By default the
width of the curve is constant along the Bézier curve it follows. By
setting the <code>waist</code> aesthetic, the width of the curve is
blown up, or shrunk down at its center. There are also
<code>scale_waist_*</code> functions (like
<code><a href="../reference/scale_waist.html">scale_waist_continuous()</a></code>), which allow you to adjust the
appearance of the waist and its legend keys.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_sankeyedge.html">geom_sankeyedge</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>waist <span class="op">=</span> <span class="va">RCSES</span>, fill <span class="op">=</span> <span class="va">service_section</span><span class="op">)</span>, position <span class="op">=</span> <span class="va">pos</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_sankeynode.html">geom_sankeynode</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">pos</span><span class="op">)</span></span></code></pre></div>
<p><img src="decorating_files/figure-html/curve_waist-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="keys-and-legends">Keys and legends<a class="anchor" aria-label="anchor" href="#keys-and-legends"></a>
</h2>
<p>Both nodes and edges have their own <code>draw_key()</code> function,
meaning that they are drawn automatically by
<code><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">ggplot2::guide_legend()</a></code>. When multiple aesthetics are based
on the same variable, they are combined in a single legend (where
possible). In order to make this work, you will use the same guide
(<code>"legend"</code> in case of the example below) for both
scales.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_sankeyedge.html">geom_sankeyedge</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>waist <span class="op">=</span> <span class="va">RCSES</span>, fill <span class="op">=</span> <span class="va">RCSES</span><span class="op">)</span>, position <span class="op">=</span> <span class="va">pos</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_sankeynode.html">geom_sankeynode</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">pos</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/scale_waist.html">scale_waist_binned</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="st">"legend"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_continuous.html" class="external-link">scale_fill_binned</a></span><span class="op">(</span>guide <span class="op">=</span> <span class="st">"legend"</span><span class="op">)</span></span></code></pre></div>
<p><img src="decorating_files/figure-html/legend_keys-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="different-themes">Different themes<a class="anchor" aria-label="anchor" href="#different-themes"></a>
</h2>
<p>At the top of this vignette we set
<code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">ggplot2::theme_light()</a></code> as the default theme. It is also
possible to add themes directly to the plot:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_sankeyedge.html">geom_sankeyedge</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">RCSES</span><span class="op">)</span>, position <span class="op">=</span> <span class="va">pos</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_sankeynode.html">geom_sankeynode</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">pos</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="decorating_files/figure-html/theme_void-1.png" width="576"></p>
<p>To change the colour scheme of the coloured aesthetics, you need to
add the appropriate colour scale. Let’s add some turbo colours to our
diagram:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_sankeyedge.html">geom_sankeyedge</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">RCSES</span><span class="op">)</span>, position <span class="op">=</span> <span class="va">pos</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_sankeynode.html">geom_sankeynode</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">pos</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>option <span class="op">=</span> <span class="st">"turbo"</span><span class="op">)</span></span></code></pre></div>
<p><img src="decorating_files/figure-html/colour_turbo-1.png" width="576"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pepijn de Vries.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
