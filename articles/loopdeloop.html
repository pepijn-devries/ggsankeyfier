<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Loop De Loop • ggsankeyfier</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Loop De Loop">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ggsankeyfier</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.8.0003</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/data_management.html">Sankey data management</a></li>
    <li><a class="dropdown-item" href="../articles/decorating.html">Decorating Sankey diagrams</a></li>
    <li><a class="dropdown-item" href="../articles/loopdeloop.html">Loop De Loop</a></li>
    <li><a class="dropdown-item" href="../articles/positioning.html">Positioning Sankey elements</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/pepijn-devries/ggsankeyfier/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Loop De Loop</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pepijn-devries/ggsankeyfier/blob/master/vignettes/loopdeloop.Rmd" class="external-link"><code>vignettes/loopdeloop.Rmd</code></a></small>
      <div class="d-none name"><code>loopdeloop.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="to-cycle-or-not-to-cycle">To cycle or not to cycle<a class="anchor" aria-label="anchor" href="#to-cycle-or-not-to-cycle"></a>
</h2>
<p>The <code>ggsankeyfier</code> package requires you to specify from
which node, to which node an edge flows. See
<code><a href="../articles/data_management.html">vignette("data_management")</a></code> for more technical details on
how this works. Consequently, this allows you to let edges flow to any
node in any stage. In most cases, Sankey or alluvial diagrams are
essentially stage-structured <a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph" class="external-link">directed
acyclic graphs</a>. However, the way that <code>ggsankeyfier</code>
organises data allows you to create stage-structured <a href="https://en.wikipedia.org/wiki/Directed_graph" class="external-link">directed graphs</a>.
In other words, you can create feedback loops in your diagram. This is
demonstrated in the present vignette.</p>
<p>For the examples we first need to prepare a basic plot:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pepijn-devries.github.io/ggsankeyfier/">ggsankeyfier</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/position_sankey.html">position_sankey</a></span><span class="op">(</span>v_space <span class="op">=</span> <span class="st">"auto"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Let's subset the data, to make the plot less cluttered:</span></span>
<span><span class="va">es_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pivot_stages_longer.html">pivot_stages_longer</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ecosystem_services</span>, <span class="va">RCSES</span> <span class="op">&gt;</span> <span class="fl">0.02</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"activity_realm"</span>, <span class="st">"biotic_realm"</span>, <span class="st">"service_section"</span><span class="op">)</span>,</span>
<span>  <span class="st">"RCSES"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># And prepare a basis for the plot</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">es_subset</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">stage</span>, y <span class="op">=</span> <span class="va">RCSES</span>, group <span class="op">=</span> <span class="va">node</span>,</span>
<span>                        connector <span class="op">=</span> <span class="va">connector</span>, edge_id <span class="op">=</span> <span class="va">edge_id</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_sankeynode.html">geom_sankeynode</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">pos</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_sankeyedge.html">geom_sankeyedge</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">pos</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="feedback">Feedback<a class="anchor" aria-label="anchor" href="#feedback"></a>
</h2>
<p>In order to demonstrate a feedback loop we <code>rbind</code> a
fictional edge to the demonstration data. Note that this feedback loop
does not make any sense in the context of the data. It only serves as
proof of principle. With the <code>%+%</code> operator we update the
plot with the data that includes the feedback loop.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">es_subset_feedback</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">es_subset</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      RCSES     <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>      edge_id   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">es_subset</span><span class="op">$</span><span class="va">edge_id</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>      connector <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"from"</span>, <span class="st">"to"</span><span class="op">)</span>,</span>
<span>      node      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cultural"</span>, <span class="st">"Fish &amp; Cephalopods"</span><span class="op">)</span>,</span>
<span>      stage     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"service_section"</span>, <span class="st">"biotic_realm"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op"><a href="https://ggplot2.tidyverse.org/reference/gg-add.html" class="external-link">%+%</a></span> <span class="va">es_subset_feedback</span></span></code></pre></div>
<p><img src="loopdeloop_files/figure-html/back-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="self-reference">Self reference<a class="anchor" aria-label="anchor" href="#self-reference"></a>
</h2>
<p>Edges don’t even have to flow from one stage to another regardless of
its direction. Instead, it is also possible to let an edge flow from and
to the same stage. In fact, you can even let an edge flow from and to
the same node. This is illustrated in the example below, we we
<code>rbind</code> a fictional self-referencing node. Again, in the
context of the data, this self-reference does not make sense, but it
serves as proof of principle.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">es_subset_selfref</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">es_subset</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      RCSES     <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>      edge_id   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">es_subset</span><span class="op">$</span><span class="va">edge_id</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>,</span>
<span>      connector <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"from"</span>, <span class="st">"to"</span><span class="op">)</span>,</span>
<span>      node      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Cultural"</span>, <span class="st">"Cultural"</span><span class="op">)</span>,</span>
<span>      stage     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"service_section"</span>, <span class="st">"service_section"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op"><a href="https://ggplot2.tidyverse.org/reference/gg-add.html" class="external-link">%+%</a></span> <span class="va">es_subset_selfref</span></span></code></pre></div>
<p><img src="loopdeloop_files/figure-html/selfref-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Pepijn de Vries.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
