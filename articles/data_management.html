<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ggsankeyfier">
<title>Sankey data management • ggsankeyfier</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Sankey data management">
<meta property="og:description" content="ggsankeyfier">
<meta property="og:image" content="https://pepijn-devries.github.io/ggsankeyfier/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ggsankeyfier</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.7</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data_management.html">Sankey data management</a>
    <a class="dropdown-item" href="../articles/decorating.html">Decorating Sankey diagrams</a>
    <a class="dropdown-item" href="../articles/loopdeloop.html">Loop De Loop</a>
    <a class="dropdown-item" href="../articles/positioning.html">Positioning Sankey elements</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/pepijn-devries/ggsankeyfier/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Sankey data management</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pepijn-devries/ggsankeyfier/blob/HEAD/vignettes/data_management.Rmd" class="external-link"><code>vignettes/data_management.Rmd</code></a></small>
      <div class="d-none name"><code>data_management.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>ggsankeyfier</code> package needs data in a
<code>data.frame</code> in order to plot it. This
<code>data.frame</code> does not necessarily has the same format as the
data while you are processing it. In most cases data is probably
organised in a wide format with stages of the Sankey diagram in columns
of the <code>data.frame</code>. For plotting this needs to be converted
into a long format. Why and how to do this, is discussed below.</p>
</div>
<div class="section level2">
<h2 id="wide-or-long-format">Wide or long format?<a class="anchor" aria-label="anchor" href="#wide-or-long-format"></a>
</h2>
<p>A wide format would be typically used when working with the data.
This can be best understood when the framework you wish to visualise
represents a collection of cause-effect chains. In those cases each
stage would represent a link in the chain. So in a wide format each
stage (or link in the cause-effect chain) would be represented by a
column in a <code>data.frame</code>. Also, in the wide format, each row
would represent a unique cause-effect chain. The wide format is
therefore suitable for describing such chains.</p>
<p>So why do we need the long format? This is because in a Sankey
diagram, we want to visualise how information flows between stages.
Moreover, we might even want to distinguish between the start and the
end of such a flow. So, rather than the entire ‘chain’, the data format
revolves around the flow ends. This requires a long format where each
row contains information on a flow end.</p>
<p>Now, when do we work with either the wide or the long format? When
working with information on chains, it makes sense to work with a wide
format. When plotting with <code>ggsankeyfier</code> or modification of
flow information is required, a long format is more suitable.</p>
<div class="section level3">
<h3 id="converting-from-wide-to-long">Converting from wide to long<a class="anchor" aria-label="anchor" href="#converting-from-wide-to-long"></a>
</h3>
<p>This package comes with a function that allow you to pivot
information with stages organised as columns (i.e., wide format) to a
long format. All you need to do is specify which columns represent the
stages, which numeric column quantifies the size of each flow and if
there are specific aspects you wish to include as aesthetics in your
plot.</p>
<p>This is illustrated with data from <a href="https://doi.org/10.2139/ssrn.4450241" class="external-link">Piet <em>et al.</em>
(submitted)</a>, this data set describes risks to provide ecosystem
services via cause-effect chains (note that the package contains a
simplified, highly aggregated, version of the data). Where the services
are affected by activities that exert pressures onto the ecosystem
components that supply those services. Risk is expressed as a numeric
indicator (RCSES). Stages are formed by the columns named
<code>"activity_type"</code>, <code>"pressure_cat"</code>,
<code>"biotic_group"</code> and <code>"service_division"</code>. This is
pivoted from its wide format to the long format required for plotting as
follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## first get a data set with a wide format:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ecosystem_services</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## pivot to long format for plotting:</span></span>
<span><span class="va">es_long</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/pivot_stages_longer.html">pivot_stages_longer</a></span><span class="op">(</span></span>
<span>    <span class="co">## the data.frame we wish to pivot:</span></span>
<span>    data        <span class="op">=</span> <span class="va">ecosystem_services</span>,</span>
<span>    <span class="co">## the columns that represent the stages:</span></span>
<span>    stages_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"activity_type"</span>, <span class="st">"pressure_cat"</span>,</span>
<span>                    <span class="st">"biotic_realm"</span>, <span class="st">"service_division"</span><span class="op">)</span>,</span>
<span>    <span class="co">## the column that represents the size of the flows:</span></span>
<span>    values_from <span class="op">=</span> <span class="st">"RCSES"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="the-edge-id-and-connector">The edge id and connector<a class="anchor" aria-label="anchor" href="#the-edge-id-and-connector"></a>
</h2>
<p>After pivoting to the long format as illustrated above you will note
two additional columns that contain information that was not available
in the wide format. Namely the columns <code>edge_id</code> and
<code>connector</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">es_long</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "RCSES"     "edge_id"   "connector" "node"      "stage"</span></span></code></pre></div>
<p>These columns are added as the <code>ggsankeyfier</code> functions
need them for plotting the data in a Sankey diagram. More specifically,
these columns are required to distinguish between the head and tail of a
flow. This allows to apply different aesthetics to both ends of a flow
(not yet fully implemented) and to visualise feedback loops (see
<code><a href="../articles/loopdeloop.html">vignette("loopdeloop")</a></code>), which would otherwise not be
possible. The column <code>connector</code> should contain either
<code>"from"</code> (start of a flow) or <code>"to"</code> (end of a
flow). The <code>edge_id</code> contains a unique identifier for each
edge (flow), this determines which <code>"from"</code> should be
connected to which <code>"to"</code> connector. When applying the
<code>pivot_stages_longer</code> function, the <code>"from"</code> end
<code>"to"</code> connector for each edge will have an identical
value.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Pepijn de Vries.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
