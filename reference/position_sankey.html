<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Calculates the x and y positions of elements (nodes and edges) in a
Sankey diagram."><title>Position nodes and edges in a Sankey diagram — PositionSankey • ggsankeyfier</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Position nodes and edges in a Sankey diagram — PositionSankey"><meta property="og:description" content="Calculates the x and y positions of elements (nodes and edges) in a
Sankey diagram."><meta property="og:image" content="https://pepijn-devries.github.io/ggsankeyfier/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ggsankeyfier</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/data_management.html">Sankey data management</a>
    <a class="dropdown-item" href="../articles/decorating.html">Decorating Sankey diagrams</a>
    <a class="dropdown-item" href="../articles/loopdeloop.html">Loop De Loop</a>
    <a class="dropdown-item" href="../articles/positioning.html">Positioning Sankey elements</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/pepijn-devries/ggsankeyfier/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Position nodes and edges in a Sankey diagram</h1>
      <small class="dont-index">Source: <a href="https://github.com/pepijn-devries/ggsankeyfier/blob/HEAD/R/position.r" class="external-link"><code>R/position.r</code></a></small>
      <div class="d-none name"><code>position_sankey.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculates the <code>x</code> and <code>y</code> positions of elements (nodes and edges) in a
Sankey diagram.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="va">PositionSankey</span></span>
<span></span>
<span><span class="fu">position_sankey</span><span class="op">(</span></span>
<span>  width <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  align <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bottom"</span>, <span class="st">"top"</span>, <span class="st">"center"</span>, <span class="st">"justify"</span><span class="op">)</span>,</span>
<span>  order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ascending"</span>, <span class="st">"descending"</span>, <span class="st">"as_is"</span><span class="op">)</span>,</span>
<span>  h_space <span class="op">=</span> <span class="st">"auto"</span>,</span>
<span>  v_space <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  nudge_x <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  nudge_y <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  split_nodes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  split_tol <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  direction <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"forward"</span>, <span class="st">"backward"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="format">Format<a class="anchor" aria-label="anchor" href="#format"></a></h2>
    <p>An object of class <code>PositionSankey</code> (inherits from <code>Position</code>, <code>ggproto</code>, <code>gg</code>) of length 13.</p>
    </div>
    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>width</dt>
<dd><p>Width of the node (<code>numeric</code>). When <code>split_nodes</code> is set to <code>TRUE</code>
each part of the split node will have half this width. Use <code>"auto"</code> to automatically
determine a suitable width.</p></dd>


<dt>align</dt>
<dd><p>A <code>character</code> that indicates how the nodes across the stages are aligned.
It can be any of <code>"top"</code>, <code>"bottom"</code>, <code>"center"</code> or <code>"justify"</code>.</p></dd>


<dt>order</dt>
<dd><p>A <code>character</code> indicating the method to be used for the order of stacking
nodes and edges in a plot.
Should be one of: <code>ascending</code> (default), sorts nodes and edges from large to small
(largest on top); <code>descending</code> sorts nodes and edges from small to large (smallest
on top); <code>as_is</code> will leave the order of nodes and edges as they are in <code>data</code>.</p></dd>


<dt>h_space</dt>
<dd><p>Horizontal space between split nodes (<code>numeric</code>). This argument is
ignored when <code>split_nodes == FALSE</code>. Use <code>"auto"</code> to automatically position split nodes.</p></dd>


<dt>v_space</dt>
<dd><p>Vertical space between nodes (<code>numeric</code>). When set to zero (<code>0</code>),
the Sankey diagram becomes an alluvial plot. Use <code>"auto"</code> to automatically determine
a suitable vertical space.</p></dd>


<dt>nudge_x, nudge_y</dt>
<dd><p>Horizontal and vertical adjustment to nudge items by. Can
be useful for offsetting labels.</p></dd>


<dt>split_nodes</dt>
<dd><p>A <code>logical</code> value indicating whether the source and destination nodes
should be depicted as separate boxes.</p></dd>


<dt>split_tol</dt>
<dd><p>When the relative node size (resulting source and destination edges)
differs more than this fraction, the node will be displayed as two separate bars.</p></dd>


<dt>direction</dt>
<dd><p>One of <code>"forward"</code> (default) or <code>"backward"</code>. When set to <code>"backward"</code>
the direction of the edges will be inverted. In most cases this
parameter won't affect the plot. It can be helpful when you want to decorate the
end of an edge (instead of the start; see examples).</p></dd>


<dt>...</dt>
<dd><p>Arguments passed on to <code><a href="https://ggplot2.tidyverse.org/reference/ggproto.html" class="external-link">ggplot2::ggproto()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Returns a <code><a href="https://ggplot2.tidyverse.org/reference/ggplot2-ggproto.html" class="external-link">ggplot2::Position</a></code> class object.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Based on the <code>stat_*</code> function applied to the parent's (<code><a href="stat_sankey.html">stat_sankeynode()</a></code>,
<code><a href="stat_sankey.html">stat_sankeyedge</a></code>) object either node or edge positions are calculated respectively.
These positions can be used to add additional layers (e.g., text or labels) to the
plot.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Pepijn de Vries</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ecosystem_services"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pos</span>  <span class="op">&lt;-</span> <span class="fu">position_sankey</span><span class="op">(</span>v_space <span class="op">=</span> <span class="st">"auto"</span>, order <span class="op">=</span> <span class="st">"ascending"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pos2</span> <span class="op">&lt;-</span> <span class="fu">position_sankey</span><span class="op">(</span>v_space <span class="op">=</span> <span class="st">"auto"</span>, order <span class="op">=</span> <span class="st">"ascending"</span>, direction <span class="op">=</span> <span class="st">"backward"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Let's subset the data, to make the plot less cluttered:</span></span></span>
<span class="r-in"><span><span class="va">es_subset</span> <span class="op">&lt;-</span> <span class="fu"><a href="pivot_stages_longer.html">pivot_stages_longer</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">ecosystem_services</span>, <span class="va">RCSES</span> <span class="op">&gt;</span> <span class="fl">0.01</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"activity_realm"</span>, <span class="st">"biotic_realm"</span>, <span class="st">"service_section"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  <span class="st">"RCSES"</span>,</span></span>
<span class="r-in"><span>  <span class="st">"service_section"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">plot</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">es_subset</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">stage</span>, y <span class="op">=</span> <span class="va">RCSES</span>, group <span class="op">=</span> <span class="va">node</span>,</span></span>
<span class="r-in"><span>                                    connector <span class="op">=</span> <span class="va">connector</span>, edge_id <span class="op">=</span> <span class="va">edge_id</span>,</span></span>
<span class="r-in"><span>                                    fill <span class="op">=</span> <span class="va">node</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="geom_sankeynode.html">geom_sankeynode</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">pos</span><span class="op">)</span> <span class="op">+</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="geom_sankeyedge.html">geom_sankeyedge</a></span><span class="op">(</span>position <span class="op">=</span> <span class="va">pos</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">service_section</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># position labels at nodes</span></span></span>
<span class="r-in"><span><span class="va">plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">node</span><span class="op">)</span>, stat <span class="op">=</span> <span class="st">"sankeynode"</span>, position <span class="op">=</span> <span class="va">pos</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="position_sankey-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># position labels at the start of edges</span></span></span>
<span class="r-in"><span><span class="va">plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%0.2f"</span>, <span class="va">RCSES</span><span class="op">)</span><span class="op">)</span>, stat <span class="op">=</span> <span class="st">"sankeyedge"</span>, position <span class="op">=</span> <span class="va">pos</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="position_sankey-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># position labels at the end of edges</span></span></span>
<span class="r-in"><span><span class="va">plot</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%0.2f"</span>, <span class="va">RCSES</span><span class="op">)</span><span class="op">)</span>, stat <span class="op">=</span> <span class="st">"sankeyedge"</span>, position <span class="op">=</span> <span class="va">pos2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="position_sankey-3.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Pepijn de Vries.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

